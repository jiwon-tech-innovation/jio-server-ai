syntax = "proto3";

package jiaa.audio;

option java_multiple_files = true;
option java_package = "com.jiaa.common.audio";

service AudioService {
  // [Highway AI] 양방향 스트리밍: 음성 조각을 받으면서 동시에 AI 응답 청크를 보냄
  rpc TranscribeAudio(stream AudioRequest) returns (stream AudioResponse);
}

message AudioRequest {
  bytes audio_data = 1;       // VAD로 걸러진 음성 바이너리 (0.5초 단위)
  bool is_final = 2;          // True = "방금 문장 끝났음(침묵 1초 감지)"
  int64 timestamp = 3;        // 로깅용 시간
  string media_info_json = 4; // 미디어 정보 및 컨텍스트 (JSON)
  
  string process_info = 10;   // (추가) 현재 활성 프로세스 정보 (JSON)
  string windows = 11;        // (추가) 열린 창 목록 정보 (JSON)
}

message AudioResponse {
  string transcript = 1;      // 변환된 텍스트 (STT 결과 또는 AI 응답 청크)
  bool is_emergency = 2;      // 위급 상황 여부
  string intent = 3;          // 의도 분석 결과 (JSON) - 마지막 청크에만 포함
  
  // [Highway AI] Streaming 전용 필드
  bool is_partial = 4;        // True = 스트리밍 중간 청크 (TTS 재생용 텍스트)
  bool is_complete = 5;       // True = 마지막 청크 (intent JSON 포함)
  string text_chunk = 6;      // AI 응답 텍스트 조각 (TTS용)
  string emotion = 7;         // 감정 태그 (NORMAL, ANGRY, etc.)
}
